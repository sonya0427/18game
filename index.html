<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>十八仔對戰遊戲</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 50%, #000000 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        /* 背景裝飾 */
        .bg-decoration {
            position: fixed;
            inset: 0;
            opacity: 0.05;
            pointer-events: none;
            z-index: 0;
        }

        .bg-decoration::before {
            content: '';
            position: absolute;
            top: 80px;
            left: 80px;
            width: 160px;
            height: 160px;
            background: #fbbf24;
            border-radius: 50%;
            filter: blur(60px);
        }

        .bg-decoration::after {
            content: '';
            position: absolute;
            bottom: 80px;
            right: 80px;
            width: 240px;
            height: 240px;
            background: #ef4444;
            border-radius: 50%;
            filter: blur(60px);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 10;
        }

        /* 標題 */
        .title {
            text-align: center;
            margin-bottom: 40px;
        }

        .title h1 {
            font-size: 3rem;
            font-weight: bold;
            background: linear-gradient(45deg, #fbbf24, #ef4444, #fbbf24);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 16px;
        }

        .title p {
            color: #d1d5db;
            font-size: 1.125rem;
        }

        /* 音效控制 */
        .sound-control {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 16px;
            padding: 8px 16px;
            background: rgba(55, 65, 81, 0.8);
            border: 1px solid rgba(107, 114, 128, 0.5);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
        }

        .sound-control:hover {
            background: rgba(75, 85, 99, 0.8);
        }

        .sound-control.disabled {
            background: rgba(31, 41, 55, 0.8);
            color: #6b7280;
        }

        /* 計分板 */
        .scoreboard {
            background: linear-gradient(45deg, rgba(17, 24, 39, 0.8), rgba(31, 41, 55, 0.8));
            backdrop-filter: blur(16px);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 32px;
            border: 1px solid rgba(107, 114, 128, 0.5);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .score-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .player-score, .computer-score {
            text-align: center;
        }

        .score-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .player-score .score-icon {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
        }

        .computer-score .score-icon {
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
        }

        .score-label {
            color: #d1d5db;
            font-size: 1.125rem;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .score-number {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #fbbf24, #fde047);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .vs-divider {
            text-align: center;
            padding: 0 32px;
        }

        .vs-text {
            color: #9ca3af;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .vs-line {
            width: 64px;
            height: 4px;
            background: linear-gradient(90deg, #fbbf24, #9ca3af, #60a5fa);
            border-radius: 2px;
        }

        /* 遊戲區域 */
        .game-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            margin-bottom: 32px;
        }

        .player-area, .computer-area {
            backdrop-filter: blur(16px);
            border-radius: 16px;
            padding: 32px;
            border: 1px solid rgba(107, 114, 128, 0.3);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .player-area {
            background: linear-gradient(135deg, rgba(6, 78, 59, 0.4), rgba(5, 46, 22, 0.4));
            border-color: rgba(52, 211, 153, 0.3);
        }

        .computer-area {
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.4), rgba(30, 64, 175, 0.4));
            border-color: rgba(59, 130, 246, 0.3);
        }

        .area-title {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .player-area .status-dot {
            background: #10b981;
        }

        .computer-area .status-dot {
            background: #3b82f6;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* 骰子區域 */
        .dice-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .dice-container {
            backdrop-filter: blur(4px);
            border-radius: 12px;
            padding: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid rgba(107, 114, 128, 0.3);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            perspective: 1000px; /* 3D 透視效果 */
        }

        .player-area .dice-container {
            background: linear-gradient(135deg, rgba(6, 95, 70, 0.5), rgba(5, 78, 59, 0.5));
        }

        .computer-area .dice-container {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.5), rgba(29, 78, 216, 0.5));
        }

        .dice-container::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), transparent 50%, rgba(255, 255, 255, 0.05));
            border-radius: 12px;
            pointer-events: none;
        }

        .dice {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #cbd5e1 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem; /* 加大一倍 */
            font-weight: bold;
            color: #1f2937;
            box-shadow: 
                0 8px 16px -4px rgba(0, 0, 0, 0.3),
                0 4px 8px -2px rgba(0, 0, 0, 0.2),
                inset 0 2px 4px 0 rgba(255, 255, 255, 0.8),
                inset 0 -2px 4px 0 rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            position: relative;
            border: 1px solid rgba(148, 163, 184, 0.3);
        }

        /* 立體邊框效果 */
        .dice::before {
            content: '';
            position: absolute;
            inset: 2px;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.1));
            border-radius: 6px;
            pointer-events: none;
            z-index: -1;
        }

        /* 底部陰影 */
        .dice::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 2px;
            right: 2px;
            height: 4px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 50%;
            filter: blur(2px);
            z-index: -2;
        }

        /* 1點和4點用紅色 */
        .dice.red-dot {
            color: #dc2626 !important;
            text-shadow: 
                1px 1px 2px rgba(220, 38, 38, 0.3),
                0 0 4px rgba(220, 38, 38, 0.2);
        }

        /* 非紅色點數的陰影效果 */
        .dice:not(.red-dot) {
            text-shadow: 
                1px 1px 2px rgba(31, 41, 55, 0.3),
                0 0 4px rgba(31, 41, 55, 0.1);
        }

        .dice.rolling {
            animation: spin3d 0.1s linear infinite;
            filter: blur(2px);
            box-shadow: 
                0 12px 24px -6px rgba(0, 0, 0, 0.4),
                0 6px 12px -3px rgba(0, 0, 0, 0.3);
        }

        @keyframes spin3d {
            0% { transform: rotateX(0deg) rotateY(0deg); }
            25% { transform: rotateX(90deg) rotateY(90deg); }
            50% { transform: rotateX(180deg) rotateY(180deg); }
            75% { transform: rotateX(270deg) rotateY(270deg); }
            100% { transform: rotateX(360deg) rotateY(360deg); }
        }

        .dice-hidden {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #4b5563 0%, #374151 50%, #1f2937 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem; /* 加大字體 */
            font-weight: bold;
            color: #9ca3af;
            border: 1px solid rgba(107, 114, 128, 0.5);
            box-shadow: 
                0 6px 12px -3px rgba(0, 0, 0, 0.4),
                0 3px 6px -1px rgba(0, 0, 0, 0.3),
                inset 0 2px 4px 0 rgba(255, 255, 255, 0.1),
                inset 0 -2px 4px 0 rgba(0, 0, 0, 0.3);
            position: relative;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        /* 隱藏骰子的立體邊框 */
        .dice-hidden::before {
            content: '';
            position: absolute;
            inset: 2px;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.02));
            border-radius: 10px;
            pointer-events: none;
            z-index: -1;
        }

        /* 隱藏骰子的底部陰影 */
        .dice-hidden::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 2px;
            right: 2px;
            height: 3px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 50%;
            filter: blur(2px);
            z-index: -2;
        }

        .score-display {
            text-align: center;
        }

        .score-value {
            font-size: 1.875rem;
            font-weight: bold;
            background: linear-gradient(45deg, #fbbf24, #fde047);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .score-type {
            color: #d1d5db;
            margin-top: 8px;
        }

        /* 遊戲結果 */
        .game-result {
            background: linear-gradient(45deg, rgba(17, 24, 39, 0.9), rgba(31, 41, 55, 0.9));
            backdrop-filter: blur(16px);
            border-radius: 16px;
            padding: 32px;
            text-align: center;
            border: 1px solid rgba(107, 114, 128, 0.5);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            margin-bottom: 32px;
        }

        .result-title {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #fbbf24, #ef4444, #fbbf24);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 16px;
        }

        .result-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            max-width: 400px;
            margin: 0 auto;
        }

        .result-card {
            border-radius: 8px;
            padding: 12px;
        }

        .result-card.player {
            background: rgba(6, 78, 59, 0.3);
        }

        .result-card.computer {
            background: rgba(30, 58, 138, 0.3);
        }

        .result-card-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .result-card.player .result-card-title {
            color: #6ee7b7;
        }

        .result-card.computer .result-card-title {
            color: #93c5fd;
        }

        /* 控制按鈕 */
        .controls {
            display: flex;
            flex-direction: column;
            gap: 16px;
            align-items: center;
            margin-bottom: 32px;
        }

        .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 16px 40px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1.125rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            min-width: 200px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.2);
        }

        .btn:disabled {
            transform: none;
            box-shadow: none;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(45deg, #dc2626, #b91c1c);
            color: white;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(45deg, #b91c1c, #991b1b);
        }

        .btn-primary:disabled {
            background: linear-gradient(45deg, #374151, #1f2937);
            border-color: rgba(107, 114, 128, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #374151, #1f2937);
            color: white;
            border: 1px solid rgba(107, 114, 128, 0.3);
        }

        .btn-secondary:hover {
            background: linear-gradient(45deg, #4b5563, #374151);
        }

        /* 遊戲規則 */
        .rules {
            background: linear-gradient(45deg, rgba(17, 24, 39, 0.6), rgba(31, 41, 55, 0.6));
            backdrop-filter: blur(16px);
            border-radius: 16px;
            padding: 32px;
            border: 1px solid rgba(107, 114, 128, 0.5);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .rules h3 {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #fbbf24, #fde047);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 24px;
        }

        .rules-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .rule-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .rule-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-top: 8px;
            flex-shrink: 0;
        }

        .rule-dot.yellow {
            background: #fbbf24;
        }

        .rule-dot.red {
            background: #ef4444;
        }

        .rule-text {
            color: #d1d5db;
        }

        /* 煙火效果 */
        .fireworks {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            overflow: hidden;
        }

        .firework {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            animation: firework-explosion 2s ease-out forwards;
        }

        .firework.red { background: #ff4444; }
        .firework.blue { background: #4444ff; }
        .firework.green { background: #44ff44; }
        .firework.yellow { background: #ffff44; }
        .firework.purple { background: #ff44ff; }
        .firework.orange { background: #ff8844; }

        @keyframes firework-explosion {
            0% {
                transform: scale(0);
                opacity: 1;
                box-shadow: 0 0 20px currentColor;
            }
            50% {
                transform: scale(1);
                opacity: 0.8;
                box-shadow: 
                    0 0 40px currentColor,
                    0 0 80px currentColor;
            }
            100% {
                transform: scale(2);
                opacity: 0;
                box-shadow: 
                    0 0 60px currentColor,
                    0 0 120px currentColor;
            }
        }

        .sparkle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: sparkle-fall 3s linear forwards;
        }

        @keyframes sparkle-fall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
                box-shadow: 0 0 10px white;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* 勝利文字動畫 */
        .victory-text {
            animation: victory-bounce 1s ease-in-out infinite alternate;
        }

        @keyframes victory-bounce {
            0% {
                transform: scale(1) rotate(-2deg);
                text-shadow: 0 0 20px #fbbf24;
            }
            100% {
                transform: scale(1.1) rotate(2deg);
                text-shadow: 0 0 40px #fbbf24, 0 0 60px #f59e0b;
            }
        }

        /* 脈衝光暈 */
        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }

        @keyframes pulse-glow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
            }
            50% {
                box-shadow: 
                    0 0 40px rgba(251, 191, 36, 0.8),
                    0 0 80px rgba(251, 191, 36, 0.4);
            }
        }
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }

            .title h1 {
                font-size: 2rem;
            }

            .game-area {
                grid-template-columns: 1fr;
                gap: 24px;
            }

            .score-container {
                flex-direction: column;
                gap: 20px;
            }

            .vs-divider {
                padding: 0;
            }

            .controls {
                flex-direction: column;
            }

            .rules-grid {
                grid-template-columns: 1fr;
            }

            .result-details {
                grid-template-columns: 1fr;
            }
        }

        @media (min-width: 768px) {
            .controls {
                flex-direction: row;
            }
        }
    </style>
</head>
<body>
    <div class="bg-decoration"></div>
    
    <div class="container">
        <!-- 標題 -->
        <div class="title">
            <h1>十八仔對戰</h1>
            <p>傳統台灣骰子遊戲 • 與電腦對決</p>
            
            <!-- 音效控制 -->
            <div class="sound-control" id="soundControl">
                <span>🔊</span>
                <span id="soundText">音效 開啟</span>
            </div>
        </div>

        <!-- 計分板 -->
        <div class="scoreboard">
            <div class="score-container">
                <div class="player-score">
                    <div class="score-icon">🏆</div>
                    <div class="score-label">玩家勝場</div>
                    <div class="score-number" id="playerWins">0</div>
                </div>
                
                <div class="vs-divider">
                    <div class="vs-text">VS</div>
                    <div class="vs-line"></div>
                </div>
                
                <div class="computer-score">
                    <div class="score-icon">🤖</div>
                    <div class="score-label">電腦勝場</div>
                    <div class="score-number" id="computerWins">0</div>
                </div>
            </div>
        </div>

        <!-- 遊戲區域 -->
        <div class="game-area">
            <!-- 玩家區域 -->
            <div class="player-area">
                <h2 class="area-title">
                    <div class="status-dot"></div>
                    玩家
                </h2>
                
                <div class="dice-grid" id="playerDiceGrid">
                    <div class="dice-container">
                        <div class="dice" id="playerDice1">⚀</div>
                    </div>
                    <div class="dice-container">
                        <div class="dice" id="playerDice2">⚀</div>
                    </div>
                    <div class="dice-container">
                        <div class="dice" id="playerDice3">⚀</div>
                    </div>
                    <div class="dice-container">
                        <div class="dice" id="playerDice4">⚀</div>
                    </div>
                </div>
                
                <div class="score-display">
                    <div class="score-value" id="playerScore">待擲骰</div>
                    <div class="score-type" id="playerType"></div>
                </div>
            </div>

            <!-- 電腦區域 -->
            <div class="computer-area">
                <h2 class="area-title">
                    <div class="status-dot"></div>
                    電腦
                </h2>
                
                <div class="dice-grid" id="computerDiceGrid">
                    <div class="dice-container">
                        <div class="dice-hidden" id="computerDice1">?</div>
                    </div>
                    <div class="dice-container">
                        <div class="dice-hidden" id="computerDice2">?</div>
                    </div>
                    <div class="dice-container">
                        <div class="dice-hidden" id="computerDice3">?</div>
                    </div>
                    <div class="dice-container">
                        <div class="dice-hidden" id="computerDice4">?</div>
                    </div>
                </div>
                
                <div class="score-display">
                    <div class="score-value" id="computerScore">待揭曉</div>
                    <div class="score-type" id="computerType"></div>
                </div>
            </div>
        </div>

        <!-- 遊戲結果 -->
        <div class="game-result" id="gameResult" style="display: none;">
            <div class="result-title" id="resultTitle"></div>
            <div class="result-details" id="resultDetails" style="display: none;">
                <div class="result-card player">
                    <div class="result-card-title">玩家</div>
                    <div id="playerResultType"></div>
                </div>
                <div class="result-card computer">
                    <div class="result-card-title">電腦</div>
                    <div id="computerResultType"></div>
                </div>
            </div>
        </div>

        <!-- 控制按鈕 -->
        <div class="controls">
            <button class="btn btn-primary" id="rollBtn">
                ▶️ 開始擲骰
            </button>
            
            <button class="btn btn-secondary" id="resetBtn">
                🔄 重置遊戲
            </button>
        </div>

        <!-- 遊戲規則 -->
        <div class="rules">
            <h3>遊戲規則</h3>
            <div class="rules-grid">
                <div>
                    <div class="rule-item">
                        <div class="rule-dot yellow"></div>
                        <div class="rule-text">使用四顆六面骰子</div>
                    </div>
                    <div class="rule-item">
                        <div class="rule-dot yellow"></div>
                        <div class="rule-text">先扣除兩顆點數相同的骰子（對子）</div>
                    </div>
                    <div class="rule-item">
                        <div class="rule-dot yellow"></div>
                        <div class="rule-text">剩餘兩顆相加為得分</div>
                    </div>
                    <div class="rule-item">
                        <div class="rule-dot yellow"></div>
                        <div class="rule-text">兩組對子時，取較高對子 × 2 計分</div>
                    </div>
                    <div class="rule-item">
                        <div class="rule-dot yellow"></div>
                        <div class="rule-text">如 2,2,6,6 → 取6×2 = 12點（十八！）</div>
                    </div>
                </div>
                <div>
                    <div class="rule-item">
                        <div class="rule-dot red"></div>
                        <div class="rule-text">四顆或三顆都不同為「沒面」</div>
                    </div>
                    <div class="rule-item">
                        <div class="rule-dot red"></div>
                        <div class="rule-text">四顆相同為「一色」，點數最大</div>
                    </div>
                    <div class="rule-item">
                        <div class="rule-dot red"></div>
                        <div class="rule-text">三顆相同需要重擲</div>
                    </div>
                    <div class="rule-item">
                        <div class="rule-dot red"></div>
                        <div class="rule-text">最高12點稱為「十八」</div>
                    </div>
                    <div class="rule-item">
                        <div class="rule-dot red"></div>
                        <div class="rule-text">最低3點稱為「BG」</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('開始載入遊戲腳本...');
        
        // 遊戲狀態
        let gameState = {
            playerDice: [1, 1, 1, 1],
            computerDice: [1, 1, 1, 1],
            playerWins: 0,
            computerWins: 0,
            isRolling: false,
            soundEnabled: true,
            gamePhase: 'ready', // ready, rolling, result, playerReroll
            computerResult: null // 儲存電腦的結果
        };

        // DOM 元素
        const elements = {
            rollBtn: null,
            resetBtn: null,
            soundControl: null,
            soundText: null,
            playerWins: null,
            computerWins: null,
            playerScore: null,
            computerScore: null,
            playerType: null,
            computerType: null,
            gameResult: null,
            resultTitle: null,
            resultDetails: null,
            playerResultType: null,
            computerResultType: null
        };

        // 創建煙火效果
        function createFireworks() {
            console.log('🎆 啟動煙火效果！');
            
            // 創建煙火容器
            const fireworksContainer = document.createElement('div');
            fireworksContainer.className = 'fireworks';
            document.body.appendChild(fireworksContainer);
            
            const colors = ['red', 'blue', 'green', 'yellow', 'purple', 'orange'];
            let fireworkCount = 0;
            const maxFireworks = 30;
            
            // 創建多個煙火
            const fireworkInterval = setInterval(() => {
                if (fireworkCount >= maxFireworks) {
                    clearInterval(fireworkInterval);
                    // 5秒後移除煙火容器
                    setTimeout(() => {
                        if (document.body.contains(fireworksContainer)) {
                            document.body.removeChild(fireworksContainer);
                        }
                    }, 5000);
                    return;
                }
                
                // 隨機位置創建煙火
                const x = Math.random() * window.innerWidth;
                const y = Math.random() * (window.innerHeight * 0.6) + (window.innerHeight * 0.1);
                
                createSingleFirework(fireworksContainer, x, y, colors);
                fireworkCount++;
            }, 200);
            
            // 創建額外的閃爍星星
            createSparkles(fireworksContainer);
        }
        
        // 創建單個煙火
        function createSingleFirework(container, x, y, colors) {
            const particleCount = 12;
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = `firework ${color}`;
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                
                // 隨機方向和距離
                const angle = (360 / particleCount) * i;
                const distance = 50 + Math.random() * 100;
                const duration = 1.5 + Math.random() * 1;
                
                particle.style.animation = `firework-explosion ${duration}s ease-out forwards`;
                particle.style.transform = `rotate(${angle}deg) translateX(${distance}px)`;
                
                container.appendChild(particle);
                
                // 移除粒子
                setTimeout(() => {
                    if (container.contains(particle)) {
                        container.removeChild(particle);
                    }
                }, duration * 1000);
            }
        }
        
        // 創建閃爍星星
        function createSparkles(container) {
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const sparkle = document.createElement('div');
                    sparkle.className = 'sparkle';
                    sparkle.style.left = Math.random() * window.innerWidth + 'px';
                    sparkle.style.top = Math.random() * (window.innerHeight * 0.3) + 'px';
                    
                    container.appendChild(sparkle);
                    
                    // 3秒後移除
                    setTimeout(() => {
                        if (container.contains(sparkle)) {
                            container.removeChild(sparkle);
                        }
                    }, 3000);
                }, Math.random() * 2000);
            }
        }
        function playSound(type) {
            if (!gameState.soundEnabled) return;
            
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                if (type === 'roll') {
                    // 骰子滾動音效
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.type = 'square';
                    oscillator.frequency.setValueAtTime(Math.random() * 200 + 100, audioContext.currentTime);
                    
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                } else if (type === 'win') {
                    // 勝利音效
                    const notes = [523.25, 659.25, 783.99];
                    notes.forEach((freq, index) => {
                        setTimeout(() => {
                            const oscillator = audioContext.createOscillator();
                            const gainNode = audioContext.createGain();
                            
                            oscillator.type = 'sine';
                            oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
                            
                            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                            
                            oscillator.connect(gainNode);
                            gainNode.connect(audioContext.destination);
                            
                            oscillator.start(audioContext.currentTime);
                            oscillator.stop(audioContext.currentTime + 0.3);
                        }, index * 150);
                    });
                } else if (type === 'lose') {
                    // 失敗音效
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.type = 'sawtooth';
                    oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 0.5);
                    
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                }
            } catch (error) {
                console.log('Audio context not supported:', error);
            }
        }

        // 計算十八仔點數
        function calculateScore(dice) {
            const counts = {};
            dice.forEach(d => counts[d] = (counts[d] || 0) + 1);
            
            // 檢查是否為一色（四個相同）
            const values = Object.values(counts);
            if (values.includes(4)) {
                return { score: 24, type: '一色', specialType: true };
            }
            
            // 檢查是否有三個相同（沒面 - 需重擲）
            if (values.includes(3)) {
                return { score: 0, type: '沒面', specialType: true };
            }
            
            // 檢查是否為沒面（四個都不同）
            const uniqueValues = Object.keys(counts).length;
            const maxCount = Math.max(...values);
            
            // 四個都不同 或 三個不同且最大出現次數為1（表示沒有對子）
            if (uniqueValues === 4 || (uniqueValues === 3 && maxCount === 1)) {
                return { score: 0, type: '沒面', specialType: true };
            }
            
            // 找出所有的對子（點數相同且出現2次以上的）
            const pairs = [];
            for (const [value, count] of Object.entries(counts)) {
                if (count >= 2) {
                    pairs.push(parseInt(value));
                }
            }
            
            let remainingDice = [...dice];
            
            if (pairs.length > 0) {
                // 如果有多組對子，選擇點數最高的一組
                const selectedPair = Math.max(...pairs);
                
                // 移除選中的對子（兩顆）
                let pairRemoved = 0;
                remainingDice = remainingDice.filter(d => {
                    if (d === selectedPair && pairRemoved < 2) {
                        pairRemoved++;
                        return false;
                    }
                    return true;
                });
            }
            
            // 計算剩餘骰子的總和
            const finalScore = remainingDice.reduce((sum, d) => sum + d, 0);
            
            let scoreType = '';
            if (finalScore === 12) scoreType = '十八！';
            else if (finalScore === 3) scoreType = 'BG';
            else scoreType = `${finalScore}點`;
            
            return { score: finalScore, type: scoreType, specialType: false };
        }

        // 更新骰子顯示
        function updateDiceDisplay(isPlayer, dice, showDice = true) {
            const prefix = isPlayer ? 'player' : 'computer';
            
            for (let i = 1; i <= 4; i++) {
                const diceElement = document.getElementById(`${prefix}Dice${i}`);
                
                if (showDice) {
                    diceElement.className = 'dice';
                    const diceValue = dice[i - 1];
                    diceElement.textContent = getDiceSymbol(diceValue);
                    
                    // 如果是1點或4點，添加紅色樣式
                    if (diceValue === 1 || diceValue === 4) {
                        diceElement.classList.add('red-dot');
                    } else {
                        diceElement.classList.remove('red-dot');
                    }
                } else {
                    diceElement.className = 'dice-hidden';
                    diceElement.textContent = '?';
                }
            }
        }

        // 獲取骰子符號
        function getDiceSymbol(value) {
            const symbols = ['⚀', '⚁', '⚂', '⚃', '⚄', '⚅'];
            return symbols[value - 1];
        }

        // 設置骰子旋轉動畫
        function setDiceRolling(isRolling) {
            for (let i = 1; i <= 4; i++) {
                const playerDice = document.getElementById(`playerDice${i}`);
                const computerDice = document.getElementById(`computerDice${i}`);
                
                if (isRolling) {
                    playerDice.classList.add('rolling');
                    if (computerDice.className === 'dice') {
                        computerDice.classList.add('rolling');
                    }
                } else {
                    playerDice.classList.remove('rolling');
                    computerDice.classList.remove('rolling');
                }
            }
        }

        // 擲骰子
        function rollDice() {
            console.log('rollDice 函數被調用');
            if (gameState.isRolling) {
                console.log('正在擲骰中，忽略點擊');
                return;
            }
            
            gameState.isRolling = true;
            
            // 判斷是否為玩家重擲
            const isPlayerReroll = (gameState.gamePhase === 'playerReroll');
            
            if (isPlayerReroll) {
                // 玩家重擲模式：只重擲玩家骰子
                gameState.gamePhase = 'rolling';
                elements.rollBtn.textContent = '🎲 重擲中...';
                elements.rollBtn.disabled = true;
                
                // 隱藏結果但保持電腦骰子顯示
                elements.gameResult.style.display = 'none';
                elements.playerScore.textContent = '擲骰中...';
                elements.playerType.textContent = '';
                
                // 播放音效
                playSound('roll');
                
                // 開始玩家骰子旋轉動畫
                for (let i = 1; i <= 4; i++) {
                    const playerDice = document.getElementById(`playerDice${i}`);
                    playerDice.classList.add('rolling');
                }
                
                // 玩家骰子動畫效果
                const rollInterval = setInterval(() => {
                    const newPlayerDice = [
                        Math.floor(Math.random() * 6) + 1,
                        Math.floor(Math.random() * 6) + 1,
                        Math.floor(Math.random() * 6) + 1,
                        Math.floor(Math.random() * 6) + 1
                    ];
                    
                    updateDiceDisplay(true, newPlayerDice);
                    playSound('roll');
                }, 150);
                
                // 停止動畫並計算結果
                setTimeout(() => {
                    clearInterval(rollInterval);
                    
                    // 停止玩家骰子旋轉
                    for (let i = 1; i <= 4; i++) {
                        const playerDice = document.getElementById(`playerDice${i}`);
                        playerDice.classList.remove('rolling');
                    }
                    
                    // 生成玩家最終結果
                    gameState.playerDice = [
                        Math.floor(Math.random() * 6) + 1,
                        Math.floor(Math.random() * 6) + 1,
                        Math.floor(Math.random() * 6) + 1,
                        Math.floor(Math.random() * 6) + 1
                    ];
                    
                    // 更新玩家骰子顯示
                    updateDiceDisplay(true, gameState.playerDice);
                    
                    // 處理重擲後的遊戲結果
                    processGameResult();
                    
                }, 3000); // 2000 * 1.5 = 3000
                
            } else {
                // 正常擲骰模式
                gameState.gamePhase = 'rolling';
                gameState.computerResult = null; // 重置電腦結果
                
                // 隱藏結果
                elements.gameResult.style.display = 'none';
                
                // 更新按鈕狀態
                elements.rollBtn.textContent = '🎲 擲骰中...';
                elements.rollBtn.disabled = true;
                
                // 隱藏電腦骰子
                updateDiceDisplay(false, [1, 1, 1, 1], false);
                elements.computerScore.textContent = '待揭曉';
                elements.computerType.textContent = '';
                
                // 播放音效
                playSound('roll');
                
                // 開始旋轉動畫
                setDiceRolling(true);
                
                // 動畫效果
                const rollInterval = setInterval(() => {
                    const newPlayerDice = [
                        Math.floor(Math.random() * 6) + 1,
                        Math.floor(Math.random() * 6) + 1,
                        Math.floor(Math.random() * 6) + 1,
                        Math.floor(Math.random() * 6) + 1
                    ];
                    
                    updateDiceDisplay(true, newPlayerDice);
                    playSound('roll');
                }, 150);
                
                // 停止動畫並計算結果
                setTimeout(() => {
                    clearInterval(rollInterval);
                    setDiceRolling(false);
                    
                    // 生成最終結果
                    gameState.playerDice = [
                        Math.floor(Math.random() * 6) + 1,
                        Math.floor(Math.random() * 6) + 1,
                        Math.floor(Math.random() * 6) + 1,
                        Math.floor(Math.random() * 6) + 1
                    ];
                    
                    // 電腦擲骰，如果是沒面就重擲
                    generateComputerDice();
                    
                    // 更新顯示
                    updateDiceDisplay(true, gameState.playerDice);
                    updateDiceDisplay(false, gameState.computerDice, true);
                    
                    // 計算分數和判定結果
                    processGameResult();
                    
                }, 3750); // 2500 * 1.5 = 3750
            }
        }

        // 生成電腦骰子（自動重擲沒面）
        function generateComputerDice() {
            let attempts = 0;
            const maxAttempts = 10; // 避免無限循環
            
            do {
                gameState.computerDice = [
                    Math.floor(Math.random() * 6) + 1,
                    Math.floor(Math.random() * 6) + 1,
                    Math.floor(Math.random() * 6) + 1,
                    Math.floor(Math.random() * 6) + 1
                ];
                
                const computerResult = calculateScore(gameState.computerDice);
                attempts++;
                
                // 如果不是沒面，或嘗試次數過多，就停止
                if (!computerResult.specialType || computerResult.type !== '沒面' || attempts >= maxAttempts) {
                    console.log(`電腦擲骰結果: ${gameState.computerDice}, 嘗試次數: ${attempts}`);
                    break;
                }
                
                console.log(`電腦擲到沒面: ${gameState.computerDice}, 重擲中... (第${attempts}次)`);
            } while (attempts < maxAttempts);
        }

        // 處理遊戲結果
        function processGameResult() {
            // 計算分數
            const playerResult = calculateScore(gameState.playerDice);
            const computerResult = gameState.computerResult || calculateScore(gameState.computerDice);
            
            // 儲存電腦結果（用於玩家重擲時保持不變）
            gameState.computerResult = computerResult;
            
            // 更新分數顯示
            elements.playerScore.textContent = playerResult.score > 0 ? `${playerResult.score}點` : playerResult.type;
            elements.playerType.textContent = playerResult.type;
            elements.computerScore.textContent = computerResult.score > 0 ? `${computerResult.score}點` : computerResult.type;
            elements.computerType.textContent = computerResult.type;
            
            // 判定勝負
            let result = '';
            let soundType = '';
            
            // 檢查玩家是否需要重擲
            const playerNeedsReroll = (playerResult.specialType && playerResult.type === '沒面');
            
            if (playerNeedsReroll) {
                result = '玩家沒面，需重擲！電腦等待中...';
                gameState.gamePhase = 'playerReroll';
                elements.rollBtn.textContent = '🎲 玩家重擲';
            } else if (playerResult.specialType && playerResult.type === '一色') {
                result = '玩家一色獲勝！🎉';
                gameState.playerWins++;
                soundType = 'win';
                gameState.gamePhase = 'result';
                elements.rollBtn.textContent = '▶️ 開始擲骰';
                
                // 一色獲勝時觸發更盛大的煙火效果
                setTimeout(() => {
                    createFireworks();
                    setTimeout(() => createFireworks(), 1000); // 雙重煙火
                }, 500);
                            } else if (computerResult.specialType && computerResult.type === '一色') {
                result = '電腦一色獲勝！';
                gameState.computerWins++;
                soundType = 'lose';
                gameState.gamePhase = 'result';
                elements.rollBtn.textContent = '▶️ 開始擲骰';
            } else if (playerResult.score > computerResult.score) {
                result = '玩家獲勝！🎉';
                gameState.playerWins++;
                soundType = 'win';
                gameState.gamePhase = 'result';
                elements.rollBtn.textContent = '▶️ 開始擲骰';
                
                // 玩家獲勝時觸發煙火效果
                setTimeout(() => {
                    createFireworks();
                }, 500);
            } else if (computerResult.score > playerResult.score) {
                result = '電腦獲勝！';
                gameState.computerWins++;
                soundType = 'lose';
                gameState.gamePhase = 'result';
                elements.rollBtn.textContent = '▶️ 開始擲骰';
            } else {
                result = '平手！';
                gameState.gamePhase = 'result';
                elements.rollBtn.textContent = '▶️ 開始擲骰';
            }
            
            // 更新勝場數
            elements.playerWins.textContent = gameState.playerWins;
            elements.computerWins.textContent = gameState.computerWins;
            
            // 顯示結果
            elements.resultTitle.textContent = result;
            elements.playerResultType.textContent = playerResult.type;
            elements.computerResultType.textContent = computerResult.type;
            elements.gameResult.style.display = 'block';
            elements.resultDetails.style.display = 'grid';
            
            // 玩家獲勝時添加特殊樣式
            if (soundType === 'win') {
                elements.resultTitle.classList.add('victory-text');
                elements.gameResult.classList.add('pulse-glow');
                
                // 3秒後移除特殊樣式
                setTimeout(() => {
                    elements.resultTitle.classList.remove('victory-text');
                    elements.gameResult.classList.remove('pulse-glow');
                }, 3000);
            }
            
            // 播放結果音效
            if (soundType) {
                setTimeout(() => playSound(soundType), 300);
            }
            
            // 重置按鈕狀態
            gameState.isRolling = false;
            elements.rollBtn.disabled = false;
        }

        // 重置遊戲
        function resetGame() {
            console.log('resetGame 函數被調用');
            gameState = {
                playerDice: [1, 1, 1, 1],
                computerDice: [1, 1, 1, 1],
                playerWins: 0,
                computerWins: 0,
                isRolling: false,
                soundEnabled: gameState.soundEnabled,
                gamePhase: 'ready',
                computerResult: null
            };
            
            // 重置顯示
            updateDiceDisplay(true, [1, 1, 1, 1]);
            updateDiceDisplay(false, [1, 1, 1, 1], false);
            
            elements.playerScore.textContent = '待擲骰';
            elements.computerScore.textContent = '待揭曉';
            elements.playerType.textContent = '';
            elements.computerType.textContent = '';
            elements.playerWins.textContent = '0';
            elements.computerWins.textContent = '0';
            elements.gameResult.style.display = 'none';
            elements.rollBtn.disabled = false;
            elements.rollBtn.textContent = '▶️ 開始擲骰';
        }

        // 切換音效
        function toggleSound() {
            console.log('toggleSound 函數被調用');
            gameState.soundEnabled = !gameState.soundEnabled;
            elements.soundText.textContent = gameState.soundEnabled ? '音效 開啟' : '音效 關閉';
            elements.soundControl.className = gameState.soundEnabled ? 'sound-control' : 'sound-control disabled';
        }

        // 初始化DOM元素
        function initElements() {
            console.log('初始化DOM元素...');
            elements.rollBtn = document.getElementById('rollBtn');
            elements.resetBtn = document.getElementById('resetBtn');
            elements.soundControl = document.getElementById('soundControl');
            elements.soundText = document.getElementById('soundText');
            elements.playerWins = document.getElementById('playerWins');
            elements.computerWins = document.getElementById('computerWins');
            elements.playerScore = document.getElementById('playerScore');
            elements.computerScore = document.getElementById('computerScore');
            elements.playerType = document.getElementById('playerType');
            elements.computerType = document.getElementById('computerType');
            elements.gameResult = document.getElementById('gameResult');
            elements.resultTitle = document.getElementById('resultTitle');
            elements.resultDetails = document.getElementById('resultDetails');
            elements.playerResultType = document.getElementById('playerResultType');
            elements.computerResultType = document.getElementById('computerResultType');
            
            // 檢查關鍵元素是否存在
            if (!elements.rollBtn) {
                console.error('找不到 rollBtn 元素');
                return false;
            }
            if (!elements.resetBtn) {
                console.error('找不到 resetBtn 元素');
                return false;
            }
            if (!elements.soundControl) {
                console.error('找不到 soundControl 元素');
                return false;
            }
            
            console.log('所有DOM元素初始化成功');
            return true;
        }

        // 初始化函數
        function initGame() {
            console.log('開始初始化遊戲...');
            
            // 初始化DOM元素
            if (!initElements()) {
                console.error('DOM元素初始化失敗');
                return;
            }
            
            // 確保 DOM 已載入
            updateDiceDisplay(true, gameState.playerDice);
            updateDiceDisplay(false, gameState.computerDice, false);
            
            // 綁定事件監聽器
            elements.rollBtn.addEventListener('click', function() {
                console.log('開始擲骰按鈕被點擊');
                rollDice();
            });
            
            elements.resetBtn.addEventListener('click', function() {
                console.log('重置遊戲按鈕被點擊');
                resetGame();
            });
            
            elements.soundControl.addEventListener('click', function() {
                console.log('音效控制按鈕被點擊');
                toggleSound();
            });
            
            console.log('遊戲初始化完成！');
        }

        // 當 DOM 完全載入後執行
        if (document.readyState === 'loading') {
            console.log('等待DOM載入...');
            document.addEventListener('DOMContentLoaded', initGame);
        } else {
            console.log('DOM已載入，直接初始化');
            initGame();
        }
    </script>
</body>
</html>